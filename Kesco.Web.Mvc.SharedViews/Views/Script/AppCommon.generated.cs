#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace ASP
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    using Kesco.Web.Mvc;
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Views/Script/AppCommon.cshtml")]
    public partial class _Views_Script_AppCommon_cshtml : Kesco.Web.Mvc.SharedViews.SharedViewPage<dynamic>
    {
        public _Views_Script_AppCommon_cshtml()
        {
        }
        public override void Execute()
        {
            
            #line 2 "..\..\Views\Script\AppCommon.cshtml"
  
    /* Ищем в URL параметр hideOldVer, пишем его в сессию. Требуется для скрытия кнопки "Открыть в старой версии"  */
    string hideOldVerRequest = HttpContext.Current.Request["hideOldVer"];
    var hideOldVerSession = HttpContext.Current.Session["hideOldVer"];
    string hideOldVer = "false";

    if (!String.IsNullOrEmpty(hideOldVerRequest))
    {
        HttpContext.Current.Session["hideOldVer"] = hideOldVer = hideOldVerRequest;
    }
    else if (hideOldVerSession != null)
    {
        hideOldVer = hideOldVerSession.ToString();
    }

            
            #line default
            #line hidden
WriteLiteral("\r\n");

WriteLiteral("\r\n\r\n;(function (window, $, undefined) {\r\n    var kesco_ip = \'");

            
            #line 20 "..\..\Views\Script\AppCommon.cshtml"
                Write(Request.ServerVariables["HTTP_X_FORWARDED_FOR"] ?? Request.ServerVariables["REMOTE_ADDR"]);

            
            #line default
            #line hidden
WriteLiteral("\';\r\n\tif (window.Env === undefined) {\r\n\t\t// TODO: what to do???\r\n\t}\r\n\tvar Env = wi" +
"ndow.Env;\r\n\tif (window.console) console.log(\"ClientSideVM: запуск \"+new Date());" +
"\r\n\tvar ViewModel = {\r\n\t\t_garbage: ko.observable(0),\r\n\t\tAppName: Env.AppName,\r\n\t\t" +
"ClientHostAddress: Env.ClientHostAddress,\r\n\t\tClientName: \'\',\r\n\t\tControlNameToFoc" +
"us: \'\',\r\n\t\tPageLoaded: ko.observable(false),\r\n\t\tProcessing: ko.observable(false)" +
",\r\n\t\tScriptStartTime: new Date(),\r\n\r\n\t\tEmployeePhones: ko.observableArray([]),\r\n" +
"\t\tEmployeePhonesLoading: ko.observable(false),\r\n\t\tCallStation: {\r\n\t\t\tMode: ko.ob" +
"servable(0),\r\n\t\t\tMessage: ko.observable(\'\'),\r\n\t\t\tPhone: ko.observable($.cookie(\"" +
"ep\")),\r\n\t\t\tPhoneInfo: ko.observable({}),\r\n\t\t\tPhoneLocation: ko.observable(),\r\n\t\t" +
"\tTargetPhone: ko.observable(\'\'),\r\n\t\t\tTargetPhoneDisplay: ko.observable(\'\'),\r\n\t\t\t" +
"Calling: ko.observable(false),\r\n\t\t\tCallInfo: null,\r\n\t\t\tMonitorID: ko.observable(" +
"),\r\n\t\t\tSaveSettings: ko.observable($.cookie(\"eps\")),\r\n\t\t\tCallEstablishing: ko.ob" +
"servable(false)\r\n\t\t},\r\n\t\tDefaultEmployeePhone: ko.observable($.cookie(\"ep\")),\r\n\r" +
"\n\r\n\t\tcloseDialog: function () { \r\n\t\t\tvar opener = window.opener || window.parent" +
";\r\n\t\t\tif (opener && !opener.closed) {\r\n\t\t\t\topener.blur();\r\n\t\t\t\topener.focus();\r\n" +
"\t\t\t} \r\n\t\t\twindow.self.close();\r\n\t\t},\r\n\t\trefreshPage: function () { \r\n\t\t\tViewMode" +
"l.Processing(true);\r\n\t\t\tif (window.top != window.self) {\r\n\t\t\t\t// Перегрузим IFRA" +
"ME\r\n\t\t\t\twindow.parent.document.getElementById(window.self.name).src = window.sel" +
"f.location + \"&t=1\";\r\n\t\t\t} else {\r\n\t\t\t\twindow.location.reload();\r\n\t\t\t}\r\n\t\t\tViewM" +
"odel.Processing(false);\r\n\t\t},\r\n\r\n\t\tshowUser: function (id) {\r\n\t\t\topenPopupWindow" +
"(Env.URI_user_form+\'?id=\'+id+\'&hideOldVer=\'+");

            
            #line 75 "..\..\Views\Script\AppCommon.cshtml"
                                                          Write(hideOldVer);

            
            #line default
            #line hidden
WriteLiteral(", null, null, \"wnd_ViewUser_\"+id, 800, 600, { close: false, centerScreen:0 });\r\n\t" +
"\t},\r\n\r\n\t\tshowPerson: function (id) {\r\n\t\t\topenPopupWindow(Env.URI_person_form+\'?i" +
"d=\'+id+\'&hideOldVer=\'+");

            
            #line 79 "..\..\Views\Script\AppCommon.cshtml"
                                                            Write(hideOldVer);

            
            #line default
            #line hidden
WriteLiteral(@", null, null, ""wnd_ViewPerson_""+id, 800, 600, { close: false, centerScreen:0 });
		},

		showResource: function (id) {
			openPopupWindow(Env.URI_resource_form+'?id='+id, null, null, ""wnd_ShowResource_""+id, 800, 600, { close: false, centerScreen:0 });
        },

        showDocument: function (id, newwindow, openImage, success, failure) {
            $.srv4js.OpenDoc(id, newwindow, openImage, function(state) {
	            if(!state.error)
		            switch(state.value)
		            {
                        case '-1': alert($.validator.format('");

            
            #line 91 "..\..\Views\Script\AppCommon.cshtml"
                                                         Write(Html.Raw(Kesco.Web.Mvc.SharedViews.Localization.Resources.Documents_Controls_DocumentsArhiveErrorMessage));

            
            #line default
            #line hidden
WriteLiteral(@"{0}', ':\n' + state.errorMsg));
                        if (failure && $.isFunction(failure))
                        {                        
                            failure(state);
                        }        
                        break;
			            case '0':
                        default: 
                        if (success && $.isFunction(success))
                        {                        
                            success(state);
                        }        
                        break;
		            }
            else {
                        alert($.validator.format('");

            
            #line 106 "..\..\Views\Script\AppCommon.cshtml"
                                              Write(Html.Raw(Kesco.Web.Mvc.SharedViews.Localization.Resources.Documents_Controls_DocumentsArhiveErrorMessage));

            
            #line default
            #line hidden
WriteLiteral(@"{0}', ':\n' + state.errorMsg));
                        if (failure && $.isFunction(failure))
                        {                        
                            failure(state);
                        } 
                }
            });
        },

      
        showPhoneList: function(path){
            $.support.cors = true;
            $.get(path, function (data) {
                var resultHTML = data.replace(/<!--CSSBLOCK.+([^;])+ENDCSSBLOCK-->/, """");
                $('#PhoneCalling_Dialog').html(resultHTML);
            });
            $('#PhoneCalling_Dialog').dialog('open');
        },
        sendMessage: function (id, signer, msg, empids, success, failure) {
            $.srv4js.SendMessage(id, signer, msg, empids, function(state) {
	            if(!state.error)
		            switch(state.value)
		            {
                        case '-1': alert($.validator.format('");

            
            #line 129 "..\..\Views\Script\AppCommon.cshtml"
                                                         Write(Html.Raw(Kesco.Web.Mvc.SharedViews.Localization.Resources.Documents_Controls_DocumentsArhiveErrorMessage));

            
            #line default
            #line hidden
WriteLiteral(@"{0}', ':\n' + state.errorMsg));
                        if (failure && $.isFunction(failure))
                        {                        
                            failure(state);
                        }        
                        break;
			            case '0':
                        default: 
                        if (success && $.isFunction(success))
                        {                        
                            success(state);
                        }        
                        break;
		            }
            else {
                        alert($.validator.format('");

            
            #line 144 "..\..\Views\Script\AppCommon.cshtml"
                                              Write(Html.Raw(Kesco.Web.Mvc.SharedViews.Localization.Resources.Documents_Controls_DocumentsArhiveErrorMessage));

            
            #line default
            #line hidden
WriteLiteral("{0}\', \':\\n\' + state.errorMsg));\r\n                        if (failure && $.isFunct" +
"ion(failure))\r\n                        {                        \r\n              " +
"              failure(state);\r\n                        } \r\n                }\r\n  " +
"          });\r\n        },\r\n\r\n        validateEmail: function (email) { return tr" +
"ue; },\r\n\r\n\t\tsendEmail: function (email)\r\n\t\t{\r\n\t\t\tif (!this.validateEmail(email))" +
" {\r\n\t\t\t\talert(Env.Localization.ClientSideViewModel_IncorrectEmail);\r\n\t\t\t\treturn;" +
"\r\n\t\t\t}\r\n\t\t\twindow.open(\'mailto:\'+email);\r\n\t\t},\r\n\r\n\t\topenMessengerChat: function " +
"(contact)\r\n\t\t{\r\n\t\t\ttry {\r\n\t\t\t\tvar obj = new ActiveXObject(\"Messenger.MessengerAp" +
"p\");\r\n\t\t\t\tif(obj) obj.LaunchIMUI(contact);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tpostClientErro" +
"r(e.message, \'\', \'openMessengerChat\');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tshowPersonInfo: function" +
"(personID, title, $target, positionMy, positionAt, showEvent, createSpan, option" +
"s) {\r\n\t\t\tif (!personID) return;\r\n\t\t\tvar url = Env.URI_person_info;\r\n\t\t\turl = url" +
".replace(\"/0\", \"/\"+personID);\r\n\t\t\tthis.showTip(url, title, $target, positionMy, " +
"positionAt, showEvent, createSpan, options);\r\n\t\t},\r\n\r\n\t\tshowEmployeeInfo: functi" +
"on(employeeID, title, $target, positionMy, positionAt, showEvent, createSpan, op" +
"tions) {\r\n\t\t\tif (!employeeID) return;\r\n\t\t\tvar url = Env.URI_user_info;\r\n\t\t\turl =" +
" url.replace(\"/0\", \"/\"+employeeID);\r\n\t\t\tthis.showTip(url, title, $target, positi" +
"onMy, positionAt, showEvent, createSpan, options);\r\n\t\t},\r\n\r\n\t\tshowTip: function(" +
"url, title, $target, positionMy, positionAt, showEvent, createSpan, options) {\r\n" +
"\t\t\tif (!$target.data(\"qtip\")) {\r\n\t\t\t\tthis.createTip($target, url, title, positio" +
"nMy, positionAt, showEvent, createSpan, options);\r\n\t\t\t\t$target.qtip(\"show\");\r\n\t\t" +
"\t\t$(\"#ui-tooltip-\"+$target.qtip(\"api\").get(\'id\')).resizable({\r\n\t\t\t\t\tanimate2: tr" +
"ue, animateDuration2: \"fast\",\r\n\t\t\t\t\tminWidth: 320, minHeight: 160,\r\n\t\t\t\t\tstart: " +
"function() {\r\n\t\t\t\t\t\t$target.qtip(\"api\").set({ \'hide.event\': false});\r\n\t\t\t\t\t},\r\n\t" +
"\t\t\t\tend: function() {\r\n\t\t\t\t\t\t$target.qtip(\"api\").set({ \'hide.event\': \'mouseleave" +
"\'});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (showEvent) return;\r\n\t\t\t\t$target\r\n\t\t\t" +
"\t\t.qtip(\"option\",\"content.ajax.url\", url)\r\n\t\t\t\t\t.qtip(\"toggle\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n" +
"\t\tcreateTip: function($target, url, title, positionMy, positionAt, showEvent, cr" +
"eateSpan, options) {\r\n\t\t\tcreateSpan = !! createSpan;\r\n\t\t\tif ($target.data(\"qtip\"" +
")) return;\r\n\t\t\tvar $span = false;\r\n\t\t\tif (createSpan) {\r\n\t\t\t\t$span = $(\"<span");

WriteLiteral(" style=\'position: relative;\'");

WriteLiteral(@"></span>""); 
				$target.after($span);
			}
			options = options || {};
			var position = $.extend({
					container: $span,
					my: positionMy, 
					at: positionAt,
					target: $target,
					viewport: $(""#dialogContentPane""),
					adjust: { method: 'shift' } 
				}, (options.position)?options.position:{});
			options.position = position;
			var o = $.extend({
				content: {
					text: '&nbsp;', 
					ajax: {
						url: url,
						beforeSend: function() {
							$target.css('cursor', ""wait !important"");
							this.set('content.text', ""&nbsp;"");
							this.set('content.title.text', """");
						},
						success: function(data){
							var container = $(""#dialogContentPane"");
							var width = Math.floor(container.width()/10)*6;
							var height = Math.floor(container.height()/10)*8;
							var content = ""<div");

WriteLiteral(" style=\'overflow: auto; max-height:\"+height+\"px;\'");

WriteLiteral(">\"+data+\"</div>\";\r\n\t\t\t\t\t\t\tthis.set(\'content.text\', content);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terr" +
"or: function(xhr, status, errorThrown){\r\n\t\t\t\t\t\t\t//do something with data\r\n\t\t\t\t\t\t" +
"\tif (status == \"parsererror\") {\r\n\t\t\t\t\t\t\t\tthis.set(\'content.text\', xhr.responseTe" +
"xt);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomplete: function() {\r\n\t\t\t\t\t\t\tthis.set(\'content" +
".title.text\', \"\");\r\n\t\t\t\t\t\t\t$target.css(\'cursor\', \"cursor\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t" +
"\t\t\t\ttitle: {\r\n\t\t\t\t\t\ttext: \"&nbsp;\", \r\n\t\t\t\t\t\tbutton: Env.Localization.GUI_Button_" +
"Close\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tposition: position,\r\n\t\t\t\tshow: { event: showEvent,  s" +
"olo: true, delay: 1000 },\r\n\t\t\t\thide: { delay: 200, fixed: true },\r\n\t\t\t\tstyle: { " +
"classes: \'ui-tooltip-shadow\', widget: true }\r\n\t\t\t}, options || {});\r\n\r\n\t\t\t$targe" +
"t.qtip(o);\r\n\r\n\t\t\t$target.bind(\"keydown\", function( ev ) {\r\n\t\t\t\tvar keyCodes = $." +
"ui.keyCode;\r\n\t\t\t\tvar keyCode = ev.keyCode;\r\n\r\n\t\t\t\tif (keyCodes.ESCAPE == keyCode" +
" ) {\r\n\t\t\t\t\tif ($target.qtip(\"api\").elements.tooltip.is(\':visible\')) {\r\n\t\t\t\t\t\tev." +
"stopImmediatePropagation();\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tsetTimeout(functi" +
"on() {\r\n\t\t\t\t\t\t\t$target.qtip(\"hide\");\r\n\t\t\t\t\t\t}, 10);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}" +
"\r\n\t\t\t\t} \r\n\t\t\t});\r\n\r\n\t\t\t//$._data($target.get(0), \'events\').keydown.reverse();\r\n\r" +
"\n\t\t},\r\n\r\n\t\textractListItemPropertyAsArray: function (objectArray, property) {\r\n\t" +
"\t\tvar arr = [];\r\n\t\t\tif ($.isArray(objectArray)) {\r\n\t\t\t\tfor (var i = 0; i < objec" +
"tArray.length; i++) {\r\n\t\t\t\t\tarr.push(objectArray[i][property]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t" +
"\treturn arr;\r\n\t\t},\r\n\r\n\t\trequest: function (url, model, replaceOptions) {\r\n\t\t\tvar" +
" requestOptions = $.extend({\r\n\t\t\t\t\turl: url,\r\n\t\t\t\t\ttype: \'POST\',\r\n\t\t\t\t\tdata: win" +
"dow.ko.toJSON({\r\n\t\t\t\t\t\tmodel: model\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tcontentType: \"application/js" +
"on; charset=utf-8\",\r\n\t\t\t\t\tbeforeSend: function () { ViewModel.Processing(true); " +
"},\r\n\t\t\t\t\tcomplete: function () { ViewModel.Processing(false); }\r\n\t\t\t\t},\r\n\t\t\t\trep" +
"laceOptions || {}\r\n\t\t\t);\r\n\t\t\t");

WriteLiteral(@"
			return $.ajax(requestOptions);
		},
        
        
	    copyToClipboard: function (text) {
	        text = text.substring(text.indexOf(""("", 0), text.length);
	        text = text.replace(RegExp('[^0-9]{1,}', 'ig'), '');
	        //alert(text);
	        window.clipboardData.setData(""Text"", text);
	    },
        
        FromJS: function (from, to) {
            var data = to || {};
            return ko.mapping.fromJS(from, {}, data);
        },

        ToJS: function (from, to) {
            var data = to || {};
            data = ko.mapping.toJS(from);
            return data;
        },

        ToJSON: function (from, to) {
            var data = to || {};
            data = ko.mapping.toJSON(from);
            return data;
        },

        closePhoneDialog: function()
        {
            $(""#PhoneCalling_Dialog"").dialog(""close"");
        },

        makeCall: function (contact, intlPhoneNumber, lang)
		{
			var self = this;
			if (!intlPhoneNumber) {
				RegisterClientError(""Неправильно указан телефон(КонтактRL)"");
				return;
			}

			function doMakeCall() {

				");

WriteLiteral("\r\n\r\n                var urlPhone = Env.URI_phones+\'?number=\'+contact.replace(\" \"," +
" \"\")+\'&inter=\'+intlPhoneNumber.replace(\" \", \"\") +\'&computerName=\'+ViewModel.Clie" +
"ntName+\'&lang=\'+lang;\r\n                ViewModel.showPhoneList(urlPhone);\r\n\t\t\t\t");

WriteLiteral(@"
			}

			if (self.ClientName || (ViewModel.ClientName != """" && ViewModel.ClientName != null)) doMakeCall();
			else 
				$.srv4js(""GETCLIENTNAME"", {
					callback: function(state) {
                        if(ViewModel.ClientName == """" || ViewModel.ClientName == null){
						    ViewModel.ClientName = state.value;
						    doMakeCall();
                        }
					}			
				});
			return;
		}

	};

	// Расширить глобальную модель
	window.ViewModel = $.extend(window.ViewModel || {}, ViewModel);


	");

WriteLiteral("\r\n\tViewModel.CallStation.SaveSettings.subscribe(function(newValue) {\r\n\t\tif (newVa" +
"lue == \"1\") {\r\n\t\t\t$.cookie(\'eps\', newValue, { expires: 365 })\r\n\t\t\t$.cookie(\'ep\'," +
" ViewModel.CallStation.Phone(), { expires: 365 })\r\n\t\t} else {\r\n\t\t\t$.removeCookie" +
"(\'eps\');\r\n\t\t\t$.removeCookie(\'ep\');\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tViewModel.CallStation.Phone." +
"subscribe(function(newValue) {\r\n\t\tif (ViewModel.CallStation.SaveSettings()) {\r\n\t" +
"\t\t$.cookie(\'ep\', newValue, { expires: 365 })\r\n\t\t}\r\n\t});\r\n\r\n\tViewModel.DefaultEmp" +
"loyeePhone.subscribe(function(newValue) {\r\n\t\tif (!ViewModel.CallStation.SaveSett" +
"ings()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (newValue) {\r\n\t\t\t$.cookie(\'ep\', newValue, { exp" +
"ires: 365 })\r\n\t\t} else {\r\n\t\t\t$.removeCookie(\'ep\');\r\n\t\t}\r\n\t});\r\n\r\n\tViewModel.Call" +
"Station.CallingPhoneStateImage = ko.computed(function() {\r\n\t\tif (ViewModel.CallS" +
"tation.Calling()) {\r\n\t\t\treturn Env.Assets.Image_PhoneOn;\r\n\t\t}\r\n\t\treturn Env.Asse" +
"ts.Image_PhoneOff;\r\n\t});\r\n\r\n\tViewModel.CallStation.CalledPhoneStateImage = ko.co" +
"mputed(function() {\r\n\t\tif (ViewModel.CallStation.Calling()) {\r\n\t\t\tif (ViewModel." +
"_garbage() && ViewModel.CallStation.CallInfo != null) {\r\n\t\t\t\tif (0 == ViewModel." +
"CallStation.CallInfo.ConnectionState) \r\n\t\t\t\t\treturn Env.Assets.Image_PhoneIncome" +
";\r\n\t\t\t\tif (1 == ViewModel.CallStation.CallInfo.ConnectionState) \r\n\t\t\t\t\treturn En" +
"v.Assets.Image_PhoneOn;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Env.Assets.Image_PhoneOff;\r\n\t});\r\n\r" +
"\n\tfunction countdown(timeout) {\r\n\t\tvar d = $.Deferred();\r\n\t\tvar i = 0 + timeout;" +
"\r\n\t\t\t\r\n\t\tvar intervalID = setInterval(function() {\r\n\t\t\tif (d.state() == \'rejecte" +
"d\') {\r\n\t\t\t\tclearInterval(intervalID);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\td.notify(--i);\r\n\t\t\t" +
"if (i <= 0) d.resolve(0);\r\n\t\t}, 1000);\r\n\t\td.notify(i);\r\n\t\treturn d;\r\n\t}\r\n\r\n\r\n\r\n\t" +
"function getEmployeePhones() {\r\n\t\tvar xhr = $.ajax({\r\n\t\t\t\ttimeout: 15000,\r\n\t\t\t\tu" +
"rl: Env.URI_Default_GetAvailablePhones,\r\n\t\t\t\tdata: { \r\n\t\t\t\t\tclientName: ViewMode" +
"l.ClientName\r\n\t\t\t\t},\r\n\t\t\t\ttype: \'POST\',\r\n\t\t\t\tbeforeSend: function() {\r\n\t\t\t\t\tView" +
"Model.EmployeePhonesLoading(true);\r\n\t\t\t\t\tViewModel.EmployeePhones.removeAll();\r\n" +
"\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.success(function(response, status, xhr) { \r\n\t\t\t\tif (response.s" +
"tatus == \"ok\") {\r\n\t\t\t\t\t");

WriteLiteral("\r\n\t\t\t\t\tvar s = ViewModel.CallStation.Phone();\r\n\t\t\t\t\tvar phoneInfo = null;\r\n\t\t\t\t\t$" +
"(response.model.phones).each(function(idx, item) {\r\n\t\t\t\t\t\titem.PhoneID = \'\'+item" +
".PhoneNumber\r\n\t\t\t\t\t\t\t+\"/\"+item.EquipmentID;\r\n\t\t\t\t\t\tif (item.PhoneID == s) phoneI" +
"nfo = item;\r\n\t\t\t\t\t\tViewModel.EmployeePhones.push(item);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t" +
"if (response.model.phones.length == 1) {\r\n\t\t\t\t\t\tphoneInfo = response.model.phone" +
"s[0];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (phoneInfo) {\r\n\t\t\t\t\t\tViewModel.CallStation.PhoneInfo(ph" +
"oneInfo);\r\n\t\t\t\t\t\tViewModel.CallStation.Phone(phoneInfo.PhoneID);\r\n\t\t\t\t\t\tViewMode" +
"l.CallStation.PhoneLocation(phoneInfo.Location);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tViewModel" +
".CallStation.PhoneInfo({});\r\n\t\t\t\t\t\tViewModel.CallStation.Phone(\"\");\r\n\t\t\t\t\t\tViewM" +
"odel.CallStation.PhoneLocation(\"\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t} else if (response.sta" +
"tus == \"error\") {\r\n\t\t\t\t\talert(response.error.Content || response.error);\r\n\t\t\t\t}\r" +
"\n\t\t\t})\r\n\t\t\t.error(function(xhr, status, errorThrown) { \r\n\t\t\t\tif (status != \"abor" +
"t\") {\r\n\t\t\t\t\talertMessage(Env.Localization.Ajax_Alert_Title_ApplicationError\r\n\t\t\t" +
"\t\t\t, $.validator.format(Env.Localization.Ajax_Alert_Message_RequestError, status" +
", errorThrown)\r\n\t\t\t\t\t\t, Env.Localization.GUI_Button_OK);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.comp" +
"lete(function() {\r\n\t\t\t\tViewModel.EmployeePhonesLoading(false);\r\n\t\t\t});\r\n\r\n\t\tretu" +
"rn xhr; \r\n\r\n\t}\r\n\r\n\tfunction makeCall() {\r\n\t\tif (window.console) console.log(\"mak" +
"eCall\", ViewModel.CallStation.Mode(), ViewModel.CallStation.Phone(),ViewModel.Ca" +
"llStation.TargetPhone());\r\n\t\tvar phone = ViewModel.CallStation.Phone().split(\"/\"" +
");\r\n\t\tvar xhr = $.ajax({\r\n\t\t\t\ttimeout: 15000,\r\n\t\t\t\turl: Env.URI_Default_MakeCall" +
",\r\n\t\t\t\ttype: \'POST\',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tclientName: ViewModel.ClientName,\r\n\t\t\t\t\t" +
"phone: phone[0],\r\n\t\t\t\t\tequipmentID: phone[1],\r\n\t\t\t\t\ttargetPhone: ViewModel.CallS" +
"tation.TargetPhone()\r\n\t\t\t\t},\r\n\t\t\t\tbeforeSend: function() {\r\n\t\t\t\t\tViewModel.CallS" +
"tation.Message(Env.Localization.PhoneCalling_Dialog_PhoneCallState_Connecting);\r" +
"\n\t\t\t\t\tViewModel.CallStation.Calling(true);\r\n\t\t\t\t\tViewModel.CallStation.CallInfo " +
"= null;\r\n\t\t\t\t\tViewModel.CallStation.CallEstablishing(true);\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t\t" +
".success(function(response, status, xhr) { \r\n\t\t\t\tif (response.status == \"ok\") {\r" +
"\n\t\t\t\t\tif (response.model.callInfo.CallID) {\r\n\t\t\t\t\t\tViewModel.CallStation.Message" +
"(Env.Localization.PhoneCalling_Dialog_PhoneCallState_Call);\r\n\t\t\t\t\t\tViewModel.Cal" +
"lStation.Calling(true);\r\n\t\t\t\t\t\tViewModel.CallStation.CallInfo = response.model.c" +
"allInfo;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tViewModel.CallStation.Message(Env.Localization.Ma" +
"keCall_CallCannotBeEstablished\r\n\t\t\t\t\t\t\t\t+((ViewModel.EmployeePhones().length > 1" +
")?(\'<br><br>\'+Env.Localization.MakeCall_TryToCallFromAnotherPhone):\'\')\r\n\t\t\t\t\t\t\t)" +
";\r\n\t\t\t\t\t\tViewModel.CallStation.Calling(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (response." +
"status == \"error\") {\r\n\t\t\t\t\tViewModel.CallStation.Message(response.error);\r\n\t\t\t\t\t" +
"ViewModel.CallStation.Calling(false);\r\n\t\t\t\t\tViewModel.CallStation.CallInfo = nul" +
"l;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.error(function(xhr, status, errorThrown) { \r\n\t\t\t\tif (statu" +
"s != \"abort\") {\r\n\t\t\t\t\tViewModel.CallStation.Message($.validator.format(Env.Local" +
"ization.Ajax_Alert_Message_RequestError, status, errorThrown));\r\n\t\t\t\t\tViewModel." +
"CallStation.Calling(false);\r\n\t\t\t\t\tViewModel.CallStation.CallInfo = null;\r\n\t\t\t\t\ta" +
"lertMessage(Env.Localization.Ajax_Alert_Title_ApplicationError\r\n\t\t\t\t\t\t, $.valida" +
"tor.format(Env.Localization.Ajax_Alert_Message_RequestError, status, errorThrown" +
")\r\n\t\t\t\t\t\t, Env.Localization.GUI_Button_OK);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.complete(function" +
"() {\r\n\t\t\t\tViewModel._garbage(new Date());\r\n\t\t\t\tViewModel.CallStation.CallEstabli" +
"shing(false); \r\n\t\t\t});\r\n\t\treturn xhr;\r\n\t}\r\n\r\n\tfunction checkCall() {\r\n\t\tif (wind" +
"ow.console) console.log(\"checkCall\", ViewModel.CallStation.Mode(), ViewModel.Cal" +
"lStation.Phone(),ViewModel.CallStation.TargetPhone());\r\n\t\tvar phone = ViewModel." +
"CallStation.Phone().split(\"/\");\r\n\t\tvar xhr = $.ajax({\r\n\t\t\t\ttimeout: 15000,\r\n\t\t\t\t" +
"url: Env.URI_Default_CheckCall,\r\n\t\t\t\ttype: \'POST\',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tcallID: (V" +
"iewModel.CallStation.CallInfo)?ViewModel.CallStation.CallInfo.CallID:0,\r\n\t\t\t\t\tcl" +
"ientName: ViewModel.ClientName,\r\n\t\t\t\t\tphone: phone[0],\r\n\t\t\t\t\tequipmentID: phone[" +
"1],\r\n\t\t\t\t\ttargetPhone: ViewModel.CallStation.TargetPhone()\r\n\t\t\t\t},\r\n\t\t\t\tbeforeSe" +
"nd: function() {\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t\t.success(function(response, status, xhr) { " +
"\r\n\t\t\t\tif (response.status == \"ok\") {\r\n\t\t\t\t\tif (ViewModel.CallStation.Calling()) " +
"{\r\n\t\t\t\t\t\tViewModel.CallStation.Message(response.model.message);\r\n\t\t\t\t\t\tViewModel" +
".CallStation.Calling(response.model.active);\r\n\t\t\t\t\t\tViewModel.CallStation.CallIn" +
"fo = response.model.callInfo;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (response.status == \"error\"" +
") {\r\n\t\t\t\t\tViewModel.CallStation.Message(response.error);\r\n\t\t\t\t\tViewModel.CallSta" +
"tion.Calling(false);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.error(function(xhr, status, errorThrown)" +
" { \r\n\t\t\t\tif (status != \"abort\") {\r\n\t\t\t\t\tViewModel.CallStation.Message(Env.Locali" +
"zation.CheckCall_Error);\r\n\t\t\t\t\tViewModel.CallStation.Calling(false);\r\n\t\t\t\t\talert" +
"Message(Env.Localization.Ajax_Alert_Title_ApplicationError\r\n\t\t\t\t\t\t, $.validator." +
"format(Env.Localization.Ajax_Alert_Message_RequestError, status, errorThrown)\r\n\t" +
"\t\t\t\t\t, Env.Localization.GUI_Button_OK);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.complete(function() {" +
"\r\n\t\t\t\tViewModel._garbage(new Date()); \r\n\t\t\t});\r\n\t\treturn xhr;\r\n\t}\r\n\r\n\tfunction c" +
"ancelCall() {\r\n\t\tif (window.console) console.log(\"cancelCall\", ViewModel.CallSta" +
"tion.Mode(), ViewModel.CallStation.Phone(),ViewModel.CallStation.TargetPhone());" +
"\r\n\t\tvar phone = ViewModel.CallStation.Phone().split(\"/\");\r\n\t\tif (!ViewModel.Call" +
"Station.CallInfo) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar xhr = $.ajax({\r\n\t\t\t\ttimeout: 15000,\r" +
"\n\t\t\t\turl: Env.URI_Default_CancelCall,\r\n\t\t\t\ttype: \'POST\',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tcall" +
"ID: (ViewModel.CallStation.CallInfo)?ViewModel.CallStation.CallInfo.CallID:0,\r\n\t" +
"\t\t\t\tclientName: ViewModel.ClientName,\r\n\t\t\t\t\tphone: phone[0],\r\n\t\t\t\t\tequipmentID: " +
"phone[1],\r\n\t\t\t\t\ttargetPhone: ViewModel.CallStation.TargetPhone()\r\n\t\t\t\t},\r\n\t\t\t\tbe" +
"foreSend: function() { }\r\n\r\n\t\t\t})\r\n\t\t\t.success(function(response, status, xhr) {" +
" \r\n\t\t\t\tif (response.status == \"ok\") {\r\n\t\t\t\t\tViewModel.CallStation.Message(respon" +
"se.model.message);\r\n\t\t\t\t\t//ViewModel.CallStation.Calling(false);\r\n\t\t\t\t}\r\n\t\t\t\tif " +
"(response.status == \"error\") {\r\n\t\t\t\t\tViewModel.CallStation.Message(response.erro" +
"r);\r\n\t\t\t\t\tViewModel.CallStation.Calling(false);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.error(functio" +
"n(xhr, status, errorThrown) { \r\n\t\t\t\tif (status != \"abort\") {\r\n\t\t\t\t\tViewModel.Cal" +
"lStation.Message(Env.Localization.CheckCall_Error);\r\n\t\t\t\t\tViewModel.CallStation." +
"Calling(false);\r\n\t\t\t\t\talertMessage(Env.Localization.Ajax_Alert_Title_Application" +
"Error\r\n\t\t\t\t\t\t, $.validator.format(Env.Localization.Ajax_Alert_Message_RequestErr" +
"or, status, errorThrown)\r\n\t\t\t\t\t\t, Env.Localization.GUI_Button_OK);\r\n\t\t\t\t}\r\n\t\t\t})" +
"\r\n\t\t\t.complete(function() {\r\n\t\t\t\tViewModel._garbage(new Date()); \r\n\t\t\t});\r\n\t\tret" +
"urn xhr;\r\n\t}\r\n\r\n\tfunction abortPhoneDialogTask() {\r\n\t\tif ($phoneDialogTask && $p" +
"honeDialogTask.state() == \"pending\") {\r\n\t\t\tif ($phoneDialogTask.abort) $phoneDia" +
"logTask.abort();\r\n\t\t\telse $phoneDialogTask.reject();\r\n\t\t}\r\n\t}\r\n\r\n\tvar $phoneDial" +
"ogTask = null;\r\n\tvar $phoneDialogButtons = null;\r\n\tvar $phoneDialog_BeforeOpenAc" +
"tiveElement = null;\r\n\tvar $phoneDialog = $(\"#PhoneCalling_Dialog\").dialog({\r\n\t\ta" +
"utoOpen: false, \r\n\t\twidth: $.cookie(\"epw\") || 550, \r\n\t\theight: $.cookie(\"eph\") |" +
"| 230, \r\n\t\tcloseOnEscape: false,\r\n\t\tminHeight: 200, minWidth: 350, modal: true, " +
"dialogClass: \'ui-dialog-titlehidden\',\r\n\t\tresizeStop: function(ev, ui) {\r\n\t\t\t$.co" +
"okie(\"epw\", Math.floor($phoneDialog.dialog(\"option\", \"width\")), { expires: 365 }" +
");\r\n\t\t\t$.cookie(\"eph\", Math.floor($phoneDialog.dialog(\"option\", \"height\")), { ex" +
"pires: 365 });\r\n\r\n\t\t},\r\n\t\tcreate: function(ev, ui) {\r\n\t\t\tvar $widget = $($(this)" +
".dialog(\"widget\"));\r\n\t\t\t$widget.find(\'.ui-dialog-buttonpane\')\r\n\t\t\t\t.prepend(\"<di" +
"v");

WriteLiteral(" style=\'padding: 2px;\'");

WriteLiteral(" data-bind=\'style: { visibility: CallStation.Mode() == 1?\\\"visible\\\":\\\"hidden\\\" }" +
"\'");

WriteLiteral("><table><tr><td><input");

WriteLiteral(" type=\'checkbox\'");

WriteLiteral(" id=\'PhoneCalling_Dialog_SaveSetting\'");

WriteLiteral(" value=\'1\'");

WriteLiteral(" data-bind=\'checked: CallStation.SaveSettings\'");

WriteLiteral(" /></td><td><label");

WriteLiteral(" for=\'PhoneCalling_Dialog_SaveSetting\'");

WriteLiteral(">");

            
            #line 684 "..\..\Views\Script\AppCommon.cshtml"
                                                                                                                                                                                                                                                                                                                  Write(Kesco.Web.Mvc.SharedViews.Localization.Resources.PhoneCalling_Dialog_SaveAsMainWorkingPhoneAtThisLocation);

            
            #line default
            #line hidden
WriteLiteral("</label></td></tr></table></div>\");\r\n\t\t\t");

WriteLiteral(@"
			window.$phoneDialogButtons = $phoneDialogButtons = $widget.find('.ui-dialog-buttonset button'); 
		},
		open: function() {
			$phoneDialog_BeforeOpenActiveElement = $( document.activeElement );
			if (window.console) console.log($phoneDialog_BeforeOpenActiveElement);
			var qtip = $('.qtip:visible');
			if (qtip.length) qtip.qtip('hide');

			ViewModel.CallStation.Phone($.cookie(""ep"") || """");
			var targetPhone = ViewModel.CallStation.TargetPhone();
			$(this).dialog(""option"", ""title"", """" /*$.validator.format(Env.Localization.PhoneCalling_Dialog_Title2, targetPhone)*/);
			var phone = ViewModel.CallStation.Phone();
			
		},
		close: function() {
			ViewModel.CallStation.Calling(false);
			ViewModel.CallStation.CallInfo = null;
			ViewModel.CallStation.Mode(0);
			ViewModel.DefaultEmployeePhone(ViewModel.CallStation.Phone());
			if ($phoneDialog_BeforeOpenActiveElement && $phoneDialog_BeforeOpenActiveElement.length) {
				$phoneDialog_BeforeOpenActiveElement = $phoneDialog_BeforeOpenActiveElement.find(':tabbable');
				if ($phoneDialog_BeforeOpenActiveElement && $phoneDialog_BeforeOpenActiveElement.length)  $phoneDialog_BeforeOpenActiveElement.get(0).focus();
			}
		}
	});

	");

WriteLiteral("\r\n\tfunction doChoosePhone() {\r\n\t\tViewModel.CallStation.Mode(1);\r\n\t\tif (window.con" +
"sole) console.log(\"doChoosePhone\", ViewModel.CallStation.Mode(), ViewModel.CallS" +
"tation.Phone(),ViewModel.CallStation.TargetPhone());\r\n\t\t");

WriteLiteral("\r\n\t\t$.when($phoneDialogTask = getEmployeePhones())\r\n\t\t\t.done(function () {\r\n\t\t\t\t");

WriteLiteral("\r\n\t\t\t\t//var links =  $phoneDialog.find(\'.radio-button-link:tabbable:first\');\r\n\t\t\t" +
"\t//if (links && links.length) links.get(0).click();\r\n\t\t\t})\r\n\t}\r\n\t\t\r\n\tfunction do" +
"Exit() { \r\n\t\tif (window.console) console.log(\"doExit\", ViewModel.CallStation.Mod" +
"e(), ViewModel.CallStation.Phone(),ViewModel.CallStation.TargetPhone());\r\n\t\t$pho" +
"neDialog.dialog(\"close\");\r\n\t}\r\n\r\n\tfunction doCheckCall() {\r\n\t\tvar attempts = 0;\r" +
"\n\t\tvar attemptsLimit = 0;\r\n\t\tif (!ViewModel.CallStation.Calling()) {\r\n\t\t\t// Если" +
" не удалось позвонить и телефон один, отмена\r\n\t\t\tif (ViewModel.EmployeePhones()." +
"length == 1) {\r\n\t\t\t\tsetTimeout(function() { $($phoneDialogButtons.get(2)).click(" +
"); }, 2000);\r\n\t\t\t} else {\r\n\t\t\t\tif ($.isFunction($phoneDialog.data(\"OnCallEndHand" +
"ler\"))) \r\n\t\t\t\t\t$phoneDialog.data(\"OnCallEndHandler\").apply(this);\r\n\t\t\t}\r\n\t\t\tretu" +
"rn;\r\n\t\t}\r\n\r\n\t\tfunction timeoutExceeded() {\r\n\t\t\tViewModel.CallStation.Calling(fal" +
"se);\r\n\t\t\tvar callInfo = ViewModel.CallStation.CallInfo;\r\n\t\t\tViewModel.CallStatio" +
"n.CallInfo = null;\r\n\t\t\tpostClientError(\r\n\t\t\t\t[\r\n\t\t\t\t\tEnv.Localization.CheckCall_" +
"Error_CallCancellationFailed,\r\n\t\t\t\t\t\' [\',\r\n\t\t\t\t\tcallInfo.CallingPhone, \' --> \',\r" +
"\n\t\t\t\t\tcallInfo.CalledPhone, \' ConnectionState: \',\r\n\t\t\t\t\tcallInfo.ConnectionState" +
", \']\',\r\n\t\t\t\t].join(\"\"),\r\n\t\t\t\t\'Kesco.Zvonilka\',\r\n\t\t\t\t\'CheckCall\'\r\n\t\t\t);\r\n\t\t\t$phon" +
"eDialog.dialog(\"close\");\r\n\t\t}\r\n\r\n\t\tfunction intervalCheck() {\r\n\t\t\tif (window.con" +
"sole) console.log(\"intervalCheck\", ViewModel.CallStation.Mode(), ViewModel.CallS" +
"tation.Phone(),ViewModel.CallStation.TargetPhone());\r\n\t\t\tif (!ViewModel.CallStat" +
"ion.Calling()) {\r\n\t\t\t\tViewModel.CallStation.CallInfo = null; \r\n\t\t\t\tif ($.isFunct" +
"ion($phoneDialog.data(\"OnCallEndHandler\"))) \r\n\t\t\t\t\t$phoneDialog.data(\"OnCallEndH" +
"andler\").apply(this);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tattemptsLimit = $phoneDialog.data(\"" +
"AttemptsLimit\") || 0;\r\n\t\t\tif (attemptsLimit && attempts >= attemptsLimit) {\r\n\t\t\t" +
"\ttimeoutExceeded();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$.when(countdown(2))\r\n\t\t\t\t.done(funct" +
"ion () {\r\n\t\t\t\t\t$.when(checkCall())\r\n\t\t\t\t\t\t.done(function () { \r\n\t\t\t\t\t\t\tif (attem" +
"ptsLimit) ++attempts;\r\n\t\t\t\t\t\t\tintervalCheck();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.fail(fun" +
"ction () {\r\n\t\t\t\t\t//cancelCall();\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tsetTimeout(intervalCheck, 20" +
"00);\r\n\t}\r\n\r\n\t$phoneDialog.dialog(\"widget\").keydown(function(ev) {\r\n\t\tif ( ev.key" +
"Code === $.ui.keyCode.ENTER || ev.keyCode === $.ui.keyCode.NUMPAD_ENTER) {\r\n\t\t\ti" +
"f (ViewModel.CallStation.Mode() == 1) {\r\n\t\t\t\t$($phoneDialogButtons.get(1)).click" +
"();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n})(window, " +
"jQuery);\r\n\r\n");

WriteLiteral("\r\n\r\n");

WriteLiteral("\r\n\r\n\tfunction adjustWindowSize() {\r\n\t\tvar width, height;\r\n\r\n\t\tif (window.dialogWi" +
"dth != null && window.dialogHeight != null) {\r\n\t\t\tif (ViewModel.Params.Width() &" +
"& ViewModel.Params.Height()) {\r\n\t\t\t\tvar width = ViewModel.Params.Width() + \'px\';" +
"\r\n\t\t\t\tvar height = ViewModel.Params.Height() + \'px\';\r\n\t\t\t\tif (window.dialogWidth" +
" != width) window.dialogWidth = width;\r\n\t\t\t\tif (window.dialogHeight != height) w" +
"indow.dialogHeight = height;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar $activeElement$ = null;\r\n\r\n\t" +
"$(document).ready(function () {\r\n\r\n\t\tadjustWindowSize();\r\n\r\n\t\tvar $window = $(wi" +
"ndow);\r\n\t\t$window.resize(resizeContentPane);\r\n\r\n\t\tvar acceptLanguage = \'\';\r\n\t\tGl" +
"obalize.culture(\'kesco\');\r\n\r\n\t\t$.validator.methods.number = function (value, ele" +
"ment) {\r\n\t\t\tvar culture = jQuery(element).attr(\"input-culture\");\r\n\t\t\tif (!cultur" +
"e)\r\n\t\t\t\tculture = Globalize.culture().name;\r\n\t\t\tvar val = Globalize.parseFloat(v" +
"alue, 10, culture);\r\n\t\t\treturn this.optional(element) || (!isNaN(val));\r\n\t\t}\r\n\r\n" +
"\t\t// Коррекция установок datepicker для en, en-US\r\n\t\t$.datepicker.setDefaults({ " +
"changeYear: true, changeMonth: true })\r\n\t\t$.datepicker.regional[\"en\"] = $.datepi" +
"cker.regional[\"\"];\r\n\t\t$.datepicker.regional[\"en-US\"] = $.datepicker.regional[\"\"]" +
";\r\n\t\t$.datepicker.regional[\"ru-RU\"] = $.datepicker.regional[\"ru\"];\r\n\t\t$.datepick" +
"er.setDefaults($.datepicker.regional[\"ru\"]);\r\n\t\t// Установим локализацию datepic" +
"ker\r\n\t\t$.datepicker.regional[Env.Culture].dateFormat = $.datepicker.regional[\"ru" +
"\"].dateFormat;\r\n\t\t$.datepicker.setDefaults($.datepicker.regional[Env.Culture]);\r" +
"\n\r\n\t\t$(\".hoverable\").on({\r\n\t\t\tmouseenter: function () {\r\n\t\t\t\t$(this).addClass(\"u" +
"i-state-hover\");\r\n\t\t\t},\r\n\t\t\tmouseleave: function () {\r\n\t\t\t\t$(this).removeClass(\"" +
"ui-state-hover\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$(\"input,button,select\").focusin(function (e" +
") {\r\n\t\t\t$activeElement$ = e.target;\r\n\t\t\tif (window.console) console.log(\"focusin" +
": \" + $activeElement$.id);\r\n\t\t\tsetActiveTreeUnfocused();\r\n\t\t}).focusout(function" +
" (e) {\r\n\t\t\t$activeElement$ = null;\r\n\t\t})\r\n\r\n\t\t$(\"input[type=text]\").keydown(func" +
"tion (e) {\r\n\t\t\tif (e.keyCode == $.ui.keyCode.ENTER || e.keyCode == $.ui.keyCode." +
"NUMPAD_ENTER) {\r\n            if (this.className == \"ui-spinner-input hasDatepick" +
"er valid\" ||this.className == \"ui-spinner-input hasDatepicker\") {  e.keyCode = $" +
".ui.keyCode.ESCAPE; }\r\n\t\t\t\tif (!e.isPropagationStopped()){\r\n\t\t\t\t\t$(e.currentTarg" +
"et).focusNextInputField();}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Регистрация клиентских ошибок\r\n" +
"\t\twindow.onerror = postClientError;\r\n\t\t// Отмена справки по умолчанию.\r\n\t\twindow" +
".onhelp = function () { return false; }\r\n\t\t// Настройка установок Ajax-запросов " +
"по умолчанию\r\n\t\tsetupJqueryAjax();\r\n\t\tsetupJqueryUiDialog();\r\n\t\tif (Env.scriptCa" +
"pabilities.LoadGridScript) {\r\n\t\t\tsetupJqGrid();\r\n\t\t}\r\n\r\n\r\n\t}).keydown(function (" +
"e) {\r\n\t\tif (e.keyCode == 27) { // Закрытие диалога по ESC\r\n\t\t\tvar qtip = $(\'.qti" +
"p:visible\');\r\n\t\t\tif (qtip.length) {\r\n\t\t\t\tqtip.qtip(\'hide\');\r\n\t\t\t\te.stopImmediate" +
"Propagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t/*if ((wind" +
"ow.opener && window.opener != window.self) || window.dialogWidth) {\r\n\t\t\tcloseDia" +
"log();\r\n\t\t\t}*/\r\n\t\t}\r\n\t\tif (e.keyCode == 112) { // Показ справки F1\r\n\t\t\tif ($.isF" +
"unction(window.showHelp)) {\r\n\t\t\t\tshowHelp();\r\n\t\t\t}\r\n\t\t\te.stopPropagation();\r\n\t\t\t" +
"e.preventDefault();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\tfunction postClientError(ms" +
"g, url, line) {\r\n\t\tvar i;\r\n\t\tvar r = new RegExp(\"function[ ]{1,}([0-9a-z_]{1,})[" +
"^0-9a-z_]\",\"i\");\r\n\t\tvar obj=arguments.caller;\r\n\t\tvar s=\"\";\r\n\t\tvar m;\r\n\t\tvar fbod" +
"y = (obj!=null)?obj.callee:\'\';\r\n\t\twhile (obj!=null) {\r\n\t\t\targs=\'\';\r\n\t\t\tfor (i=0;" +
"i<obj.length;i++)\r\n\t\t\t\targs+=(i>0?\',\':\'\')+obj[i];\r\n\r\n\t\t\tm = r.exec(obj.callee);\r" +
"\n\t\t\ts = (((m instanceof Array)&&(m.length>1))?m[1]:\'?\')+\'(\'+args+\')\\n\\t\'+s\r\n\r\n\t\t" +
"\tobj=obj.caller;\r\n\t\t}\r\n\r\n        var appName = Env.AppName;\r\n\t\tvar errorMessage " +
"= [\"Приложение: \", appName, \"\\nСообщение: \", msg, \"\\nURL: \", url, \"\\nСтрока: \", " +
"line, \"\\n\\nСтек вызовов: \", s, \"\\n\\n\", fbody].join(\"\"); \r\n\r\n\t\t$.post(Env.URI_Def" +
"ault_RegisterClientError, {\r\n\t\t\tdetails: errorMessage\r\n\t\t});\r\n\t\talertMessage(\r\n\t" +
"\t\t\tEnv.Localization.CheckCall_Error\r\n\t\t\t\t, msg.replace(/\\n/ig, \"<br/>\") \r\n\t\t\t\t, " +
"Env.Localization.GUI_Button_OK \r\n\t\t\t);\r\n\t\treturn true;\r\n\t}\r\n    \r\n    function p" +
"ostSilverlightError(type, message)\r\n\t{\r\n\t\tvar appName = Env.AppName;\r\n\t\tvar erro" +
"rMessage = [\"Приложение: \", appName, \"\\nСообщение: \", message].join(\"\"); \r\n\t\t$.p" +
"ost(Env.URI_Default_RegisterSilverlightError, {\r\n\t\t\ttype: type,\r\n\t\t\tmsg: errorMe" +
"ssage\r\n\t\t});\r\n\t\t/*alertMessage(\r\n\t\t\t\tEnv.Localization.CheckCall_Error\r\n\t\t\t\t, err" +
"orMessage.replace(/\\n/ig, \"<br/>\") \r\n\t\t\t\t, Env.Localization.GUI_Button_OK \r\n\t\t);" +
"*/\r\n\t}\r\n\r\n\tfunction setupJqueryUiDialog() { }\r\n\r\n\tfunction setupJqueryAjax() {\r\n" +
"\t\t$.ajaxSetup({\r\n\t\t\tcache: false,\r\n\t\t\ttraditional: true,\r\n\t\t\tglobal: true,\r\n\t\t\tc" +
"ontentType: \'application/x-www-form-urlencoded; charset=utf-8\'\r\n\t\t});\r\n\t\t$(docum" +
"ent)\r\n\t\t\t.ajaxStart(function () {\r\n\t\t\t\t$(\"html\").addClass(\'busy\');\r\n\t\t\t\tViewMode" +
"l.Processing(true);\r\n\t\t\t})\r\n\t\t\t.ajaxError(function (ev, xhr, settings, thrownErr" +
"or) {\r\n\t\t\t\tif (thrownError == \"abort\") return;\r\n\t\t\t\tvar appName = Env.AppName;\r\n" +
"\t\t\t\tvar errorMessage = [\"Приложение: \", appName, \"\\nСообщение: \", thrownError, \"" +
"\\nURL: \", settings.url].join(\"\"); \r\n\t\t\t\t$.post(Env.URI_Default_RegisterClientErr" +
"or, {\r\n\t\t\t\t\tdetails: errorMessage\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.ajaxComplete(function () " +
"{\r\n\t\t\t\tViewModel.Processing(false);\r\n\t\t\t\t$(\"html\").removeClass(\'busy\');\r\n\t\t\t}); " +
"\r\n\t}\r\n\r\n\tfunction setupJqGrid() {\r\n\t\tjQuery.jgrid.del = $.extend(jQuery.jgrid.de" +
"l, {\r\n\t\t\tafterSubmit: function(xhr, postedData) {\r\n\t\t\t\t//alert (\'afterSubmit\');\r" +
"\n\t\t\t\tvar ret = [true, \"\"];\r\n\t\t\t\tvar response = $.parseJSON(xhr.responseText);\r\n\t" +
"\t\t\tif (response.status == \"error\") {\r\n\t\t\t\t\tret[0] = false;\r\n\t\t\t\t\tret[1] = respon" +
"se.error;\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tvar __contentPaneResizing" +
" = false;\r\n\tvar __contentPaneResizingReset = null;\r\n\r\n\tfunction resizeContentPan" +
"e() {\r\n\t\tvar $window = $(window);\r\n\t\t\t\r\n\t\tif (window.dialogWidth!=null && window" +
".dialogHeight!=null) {\r\n\t\t\tViewModel.Params.Width = $window.width();\r\n\t\t\tViewMod" +
"el.Params.Height = $window.height();\r\n\t\t}\r\n\r\n\t\tif (__contentPaneResizing) {\r\n\t\t\t" +
"__contentPaneResizing = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t__contentPaneResizing = true;" +
"\r\n\r\n\t\tvar $header = $(\"#dialogHeader\");\r\n\t\tvar $content = $(\"#dialogContentPane\"" +
");\r\n\t\tvar $footer = $(\"#dialogFooter\");\r\n\r\n\t\t$content.width($header.outerWidth()" +
" - 6);\r\n\t\tvar height = $window.height() - $header.outerHeight() - $footer.outerH" +
"eight() - 15;\r\n\t\tif (height > 0) {\r\n\t\t\t$content.height(height);\r\n\t\t}\r\n\t\t$(\"#wndS" +
"ize\").html(\"width: \" + $window.width() + \" | height: \" + $window.height() + \" | " +
"header: \" + $header.outerHeight() + \" | footer: \" + $footer.outerHeight() + \" | " +
"content: \" + ($content.outerHeight()));\r\n\t\tclearTimeout(__contentPaneResizingRes" +
"et);\r\n\t\t__contentPaneResizingReset = setTimeout(function () {\r\n\t\t\t__contentPaneR" +
"esizing = false;\r\n\t\t}, 50);\r\n\t}\r\n\r\n\tfunction saveSettings() {\r\n\t\t// готовим JSON" +
"-данные для отправки на сервер и маппинга на Dictionary<string, string>\r\n\t\t// {\'" +
"settings[0].Key\': \"PersonBProject\", \'settings[0].Value\': \"1\", \'settings[1].Key\':" +
" \"PersonAllBProject\", \'settings[1].Value\': \"0\", ...}\r\n\r\n\t\tvar settings = {}, i =" +
" 0;\r\n\t\tif (window.dialogWidth != null && window.dialogHeight != null) {\r\n\t\t\tView" +
"Model.Params.Width = window.dialogWidth.replace(\'px\', \'\');\r\n\t\t\tViewModel.Params." +
"Height = window.dialogHeight.replace(\'px\', \'\');\r\n\t\t}\r\n\r\n\t\tvar params = {};\r\n\t\tif" +
" (ViewModel.Params)\r\n\t\t\tparams = ko.mapping.toJS(ViewModel.Params);\r\n\t\tfor (var " +
"prop in params) {\r\n\t\t\tsettings[\'settings[\' + i + \'].Key\'] = prop;\r\n\t\t\tsettings[\'" +
"settings[\' + i + \'].Value\'] = (params[prop] == null) ? \"\" : params[prop];\r\n\t\t\ti+" +
"+;\r\n\t\t}\r\n\t\tvar data = $.extend({}, settings, { clid: ViewModel.CLID() });\r\n\r\n\t\t/" +
"/alert(JSON.stringify(data));\r\n\r\n\t\treturn $.ajax({\r\n\t\t\tasync: false,\r\n\t\t\ttype: \'" +
"POST\',\r\n\t\t\turl: Env.URI_Default_SaveApplicationSettings,\r\n\t\t\ttraditional: false," +
"\r\n\t\t\tdata: data,\r\n\t\t\tbeforeSend: function() { },\r\n\t\t\tsuccess: function( data ) {" +
"},\r\n\t\t\tcomplete: function() {}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction openPopupWindow(url, cont" +
"ext, callback, windowName, width, height, replaceOptions) {\r\n\t\tvar uri = \"\"+url;" +
"\r\n\t\tvar cxt = $.extend({ type: \'GET\' }, context || {}, { url: url });\r\n\t\tif (cxt" +
".type == \'POST\') {\r\n\t\t\t");

WriteLiteral(@"
			uri = Env.URI_Default_Start;
		}
		var openOptions = $.extend({
				url: uri,
				centerScreen: 0,
				resizable: 1,
				location: 0,
				width: width,
				height: height,
				callback: callback,
				context: cxt,
				close: true
			},
			replaceOptions || {}
		);
		return $.windowManager.openWindow(openOptions);
	}

	function closeDialogAndReturnValue(value) {
		$(""#dialogResultField_Value"").val(value);
		$(""#dialogResultForm"").submit();
	}

	function closeDialog() {
		var opener = window.opener || window.parent;
		if (opener && !opener.closed) {
			opener.blur();
			opener.focus();
		}
		window.self.close();
	}

	function refreshPage() {
		window.location.reload();
	}

	function showHelp() {
		var topic = (window.ViewModel.HelpTopic)?window.ViewModel.HelpTopic():'hlpIndex';
		var url = Env.URI_WikiHelp;
		url = url + '?page=' + topic;
		openPopupWindow(url, null, null, 'wnd_Help', 800, 600, { scrollbars: 1, close: false });
	}

	$.cookie.defaults = {
	    domain: Env.Domain,
		path: '/'
	};

	var cookieDomain = Env.Domain;
	var cookiePath = '/';

	");

WriteLiteral("\r\n\t$.cookie(\"tz\", new Date().getTimezoneOffset());\r\n\r\n\tfunction DialogPageOpen(ur" +
"l, params, callback) {\r\n\t\tif (params == null) params = \'center:yes;status:no;hel" +
"p:no;resizable:yes;\';\r\n\r\n\t\twindow.showModalDialog(url, null, params);\r\n\r\n\t\t// со" +
"храняем данные из cookie\r\n\t\tvar result = null;\r\n\t\tvar dlgRez = $.cookie(\"DlgRez\"" +
");\r\n\t\tif (dlgRez == 1) {\r\n\t\t\tresult = $.cookie(\"RetVal\", {raw: true});\r\n\t\t\tif (c" +
"allback && $.isFunction(callback))\r\n\t\t\t\tcallback(result);\r\n\t\t}\r\n\r\n\t\t// очищаем д" +
"анные в cookie\r\n\t\tSetDlgRez(0);\r\n\t\t$.removeCookie(\"RetVal\");\r\n\t}\r\n\r\n\tfunction Se" +
"tDlgRez(dlgRez)\r\n\t{\r\n\t\tdocument.cookie=\'DlgRez=\'+ dlgRez +\';domain=\'+cookieDomai" +
"n+\';path=\'+cookiePath;\r\n\t}\r\n\r\n\tfunction setActiveTreeUnfocused() {\r\n\t\tif (!jQuer" +
"y.jstree) return;\r\n\t\tvar activeTree = jQuery.jstree._focused ();\r\n\t\tif (activeTr" +
"ee) activeTree.unset_focus();\r\n\t}\r\n\r\n\tfunction SetParentAction(parentAction)\r\n\t{" +
"\r\n\t\tdocument.cookie=\'ParentAction=\'+ parentAction+\';domain=\'+cookieDomain+\';path" +
"=\'+cookiePath;\r\n\t}\r\n\r\n\tfunction SetRetVal(retVal)\r\n\t{\r\n\t\tvar r = new RegExp(\"[^0" +
"-9a-z\\\\s\"+ String.fromCharCode(160) +\"]{1,}\",\"ig\"); \r\n\t\tretVal = retVal.replace(" +
"r,function($1) {return escape($1);});\r\n\t\tdocument.cookie=\'RetVal=\'+ retVal +\';do" +
"main=\'+cookieDomain+\';path=\'+cookiePath;\r\n\t}\r\n\r\n\tfunction DialogPageReturn(retVa" +
"l,parentAction)\r\n\t{\r\n\t\tSetDlgRez(1);\r\n\t\tSetRetVal(retVal);\r\n\t\tSetParentAction(pa" +
"rentAction==null?0:parentAction);\r\n\r\n\t\tvar version = parseFloat(navigator.appVer" +
"sion.split(\'MSIE\')[1]);\r\n\t\tif (version<7)\r\n\t\t\twindow.opener=this;\r\n\t\telse\r\n\t\t\twi" +
"ndow.open(\'\',\'_parent\',\'\');\r\n\r\n\t\twindow.close();\r\n\t}\r\n\r\n\tfunction searchGrid(gri" +
"dID) {\r\n\t\tvar $grid = $(gridID);\r\n\t\tvar options = $grid.getGridParam(\'searchDial" +
"ogOptions\');\r\n\t\toptions.left = 50;\r\n\t\toptions.top = 50;\r\n\t\toptions.overlay = fal" +
"se;\r\n\t\toptions.onClose = function () {\r\n\t\t\tvar ofilter = $grid.getGridParam(\"pos" +
"tData\");\r\n\t\t\tvar hasValue = true;\r\n\t\t\tvar rules = null;\r\n\t\t\tif (ofilter.filters)" +
" {\r\n\t\t\t\tvar filters = $.parseJSON(ofilter.filters);\r\n\t\t\t\tif (filters)\r\n\t\t\t\t\trule" +
"s = filters.rules;\r\n\t\t\t}\r\n\t\t\tif (rules && rules.length) {\r\n\t\t\t\tfor (var i = 0; i" +
" < rules.length; i++) {\r\n\t\t\t\t\thasValue = false;\r\n\t\t\t\t\tif (rules[i].data) {\r\n\t\t\t\t" +
"\t\thasValue = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn hasValue;\r\n\t\t}\r" +
"\n\t\t$rid.jqGrid(\'searchGrid\', options);\r\n\t}\r\n\r\n");

        }
    }
}
#pragma warning restore 1591
